# Tablet Mode (Планшетный режим)

Требования:
- Режим определяется по ширине вьюпорта: начиная с минимального размера планшета — работает только версия со столом.
- В планшетном режиме скрыть «Доставка» и «Самовывоз» (форсировать тип заказа dine-in).
- В планшетном режиме не сохранять данные при заполнении формы: телефон, адрес, слоты времени (pickupMode/pickupTime).
- Если `tableId` отсутствует — заблокировать интерфейс и показать экран «Сканируйте QR на столе».

## Детали реализации

1) Детектор планшета
- Файл: `src/lib/utils/responsive.ts`
- Логика: планшет = `window.innerWidth >= 768`.
- Экспорт:
  - `isTabletViewport()` — утилита
  - `useIsTabletMode()` — хук для клиентских компонентов

2) Блокировка UI без стола
- Файл: `src/app/(home)/[venue]/TabletGate.tsx`
- Вставлен в `layout.tsx` перед контентом. Если `isTablet` и нет `tableId` — рисует полноэкранный оверлей «Сканируйте QR‑код на столе».
- Подключение: `src/app/(home)/[venue]/layout.tsx`

3) Принудительные ограничения в режиме планшета
- Файл: `src/app/(home)/[venue]/TabletModeEnforcer.tsx`
- Подключение в `layout.tsx`. Если `isTablet`:
  - `orderType = 'dinein'`
  - Сброс: `phone = '+996'`, `address = ''`, `pickupMode = 'asap'`, `pickupTime = null`
  - Удаляет `localStorage('address')` на клиенте

4) Отключение персиста чувствительных полей
- Файл: `src/store/checkout.ts`
- В `persist.partialize` исключаем в режиме планшета: `phone`, `address`, `pickupMode`, `pickupTime`
- В `onRehydrateStorage` при планшете — форсим `dinein`, сбрасываем чувствительные поля.
- Остальные персисты не трогаем: корзина, venue, язык, бренд‑цвет — сохраняются как раньше.

5) UI: скрыть Доставка/Самовывоз (переключатель типа заказа)
- Файл: `src/app/(home)/[venue]/basket/BasketView.tsx`
- Скрываем компонент `OrderType` когда `isTablet` (также скрыт, если есть `tableId`).
- Дополнительно в планшете ещё раз форсим `orderType = 'dinein'`.

6) Prefill из localStorage
- Файл: `src/app/(home)/[venue]/basket/BasketView.tsx`
- При гидратации не читаем `phone/address` из `localStorage`, если `isTablet`.

## Изменённые файлы
- `src/lib/utils/responsive.ts` — добавлены `TABLET_MIN_WIDTH`, `isTabletViewport`, `useIsTabletMode`
- `src/store/checkout.ts` — условная персистенция и сброс в режиме планшета
- `src/app/(home)/[venue]/TabletGate.tsx` — оверлей «Сканируйте QR»
- `src/app/(home)/[venue]/TabletModeEnforcer.tsx` — форс состояния для планшета
- `src/app/(home)/[venue]/layout.tsx` — подключение `TabletGate` и `TabletModeEnforcer`
- `src/app/(home)/[venue]/basket/BasketView.tsx` — скрытие `OrderType`, запрет префиллов, форс dine‑in

## Поведение по пунктам
- ВКЛ/ВЫКЛ: Автоматически по ширине вьюпорта (>= 768px — планшет).
- Без стола: в планшетном режиме интерфейс блокируется, показывается экран с инструкцией отсканировать QR.
- Тип заказа: в планшетном режиме всегда «На месте» (dine‑in), переключатель скрыт.
- Персист: в планшете не сохраняются телефон, адрес, слоты времени. В рамках текущей сессии они работают, но после обновления страницы не восстанавливаются.
- Остальные данные (корзина, язык, бренд‑цвет, venue) сохраняются как раньше.

## Тест‑план (локально)
1) `npm run dev` и открыть маршрут `/{venue}`.
2) Узкое окно (< 768): доступен обычный режим, можно выбрать доставку/самовывоз.
3) Широкое окно (>= 768) без tableId:
   - Появляется полноэкранный оверлей «Сканируйте QR‑код на столе».
   - Переключателя «Доставка/Самовывоз/На месте» нет.
4) Широкое окно (>= 768) со столом:
   - Переключателя нет, везде используется dine‑in.
   - Ввод телефона/адреса/слотов не сохраняется между перезагрузками.
5) Проверить, что корзина и язык продолжают сохраняться.

## Замечания по SSR/гидратации
- Определение режима планшета — только на клиенте, через `window.innerWidth`. До гидратации поведение стандартное, после — включается режим планшета.
- Если потребуется SSR‑совместимый режим, можно добавить cookie/UA‑эвристику и серверный гвард.
